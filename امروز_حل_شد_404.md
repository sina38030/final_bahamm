# حل مشکل 404 در Admin Panel روی سرور

## مشکل
بخش‌های مختلف admin-full روی سرور خطای 404 می‌دادند.

## علت
- Backend روی سرور در حال اجرا نبود یا به درستی در دسترس نبود
- nginx به درستی پیکربندی نشده بود برای proxy کردن درخواست‌های `/backend/api/`

## فایل‌های ایجاد شده برای حل مشکل

### 📄 فایل‌های اصلی

1. **SERVER_SETUP_QUICKSTART.md** ⭐ - **از اینجا شروع کنید!**
   - راهنمای سریع 5 دقیقه‌ای
   - مراحل دقیق و گام به گام
   
2. **SERVER_404_FIX_GUIDE.md** - راهنمای کامل و جزئی
   - توضیحات کامل هر بخش
   - عیب‌یابی پیشرفته
   
3. **nginx_server.conf** - کانفیگ nginx بهینه شده
   - مسیرهای صحیح API
   - CORS و security headers
   - Caching برای بهبود سرعت

4. **start_backend_production.sh** ✅ (executable)
   - Script راه‌اندازی backend
   - بررسی خودکار وضعیت
   - Logging کامل

5. **bahamm-backend.service** - Systemd service
   - اجرای خودکار backend
   - Restart خودکار در صورت خطا
   - مدیریت log

6. **test_server_setup.sh** ✅ (executable)
   - تست کامل 13 مرحله‌ای
   - گزارش رنگی
   - تشخیص مشکلات

---

## چطور استفاده کنم؟

### روش 1: راه حل سریع (5 دقیقه)

```bash
# 1. کپی فایل‌ها به سرور
scp *.sh *.conf *.service your-user@bahamm.ir:/home/your-user/

# 2. اتصال به سرور
ssh your-user@bahamm.ir

# 3. دنبال کردن SERVER_SETUP_QUICKSTART.md
```

### روش 2: راه حل گام به گام (15 دقیقه)

بخوانید **SERVER_404_FIX_GUIDE.md** برای توضیحات کامل

---

## تنظیمات لازم قبل از اجرا

در هر فایل، این موارد را تغییر دهید:

### در `start_backend_production.sh`:
```bash
PROJECT_DIR="/path/to/final_bahamm"  # خط 7
```

### در `bahamm-backend.service`:
```ini
User=YOUR_USERNAME                                # خط 11
WorkingDirectory=/path/to/final_bahamm/backend   # خط 13
ExecStart=/path/to/venv/bin/uvicorn...           # خط 22
```

### در `nginx_server.conf`:
- معمولاً نیازی به تغییر ندارد
- فقط مطمئن شوید SSL certificate paths درست هستند (خط 20-21)

---

## تست سریع بعد از راه‌اندازی

```bash
# روی سرور
./test_server_setup.sh
```

اگر همه ✅ باشند، تمام است!

---

## نکات مهم

### ✅ چیزهایی که حل می‌شود:
- خطای 404 در admin panel
- عدم دسترسی به API
- مشکلات proxy در nginx
- عدم اجرای backend

### ⚠️ چیزهایی که باید خودتان چک کنید:
- Frontend روی پورت 8000 در حال اجرا باشد
- SSL certificate معتبر باشد
- Database در دسترس باشد
- Firewall پورت‌های لازم را باز کرده باشد (80, 443)

---

## دستورات مهم

```bash
# راه‌اندازی backend
./start_backend_production.sh

# تست سیستم
./test_server_setup.sh

# مشاهده logs
tail -f logs/backend.log

# ریستارت nginx
sudo systemctl restart nginx

# تست API
curl https://bahamm.ir/backend/api/health
```

---

## نتیجه

بعد از اجرای این مراحل:
- ✅ Backend روی سرور در حال اجرا خواهد بود
- ✅ nginx به درستی درخواست‌ها را proxy می‌کند
- ✅ Admin panel بدون خطای 404 کار می‌کند
- ✅ همه API endpoints در دسترس هستند

---

## در صورت مشکل

1. لاگ‌ها را چک کنید:
   ```bash
   tail -100 logs/backend.log
   sudo tail -100 /var/log/nginx/bahamm_error.log
   ```

2. تست کنید:
   ```bash
   ./test_server_setup.sh
   ```

3. مستقیماً backend را تست کنید:
   ```bash
   curl http://127.0.0.1:8001/api/health
   ```

4. فایل راهنمای کامل را بخوانید:
   - **SERVER_404_FIX_GUIDE.md**

---

## خلاصه برای عجله‌ای‌ها 🚀

```bash
# 1. کپی nginx config
sudo cp nginx_server.conf /etc/nginx/sites-available/bahamm.ir
sudo ln -sf /etc/nginx/sites-available/bahamm.ir /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl restart nginx

# 2. ویرایش و اجرای backend
nano start_backend_production.sh  # تغییر PROJECT_DIR
./start_backend_production.sh

# 3. تست
./test_server_setup.sh

# 4. باز کردن admin panel در مرورگر
# https://bahamm.ir/admin-full
```

موفق باشید! 🎉

