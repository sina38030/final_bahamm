# ๐ง ุฑุงูููุง ุฑูุน ูุดฺฉู ููุงุด ููุฌูุฏ (coins)

## โ ูุถุนุช ูุนู

ุชุณุชโูุง ูุดุงู ุฏุงุฏู ฺฉู:
- โ **Backend ฺฉุงููุงู ฺฉุงุฑ ูโฺฉูุฏ**
- โ **API endpoint `/users/me` ููุฌูุฏ ุฑุง ุฏุฑุณุช ุจุฑูโฺฏุฑุฏุงูุฏ**
- โ **ุฏุชุงุจุณ ุตุญุญ ุงุณุช**
- โ **Frontend ููุฌูุฏ 0 ููุงุด ูโุฏูุฏ**

## ๐ ุนูุช ูุดฺฉู

**localStorage ูุฏู!**

ููุช ฺฉุงุฑุจุฑ ูุจูุงู ูุงฺฏู ฺฉุฑุฏูุ ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ (ุดุงูู `coins: 0`) ุฏุฑ localStorage ุฐุฎุฑู ุดุฏู.
ุญุช ุงฺฏุฑ ุฏุฑ ูพูู ุงุฏูู ููุฌูุฏ ุฑุง ุชุบุฑ ุฏูุฏุ frontend ููฺูุงู ุงุฒ localStorage ูุฏู ุงุณุชูุงุฏู ูโฺฉูุฏ.

## ๐ฏ ุฑุงู ุญูโูุง (3 ุฑูุด)

### ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ ุตูุญู Debug (ุขุณุงูโุชุฑู) โญ

1. **ูุฑูุฑฺฏุฑ ุฑุง ุจุงุฒ ฺฉูุฏ** ู ุจู ุงู ุขุฏุฑุณ ุจุฑูุฏ:
   ```
   http://localhost:3000/debug_coins.html
   ```

2. **ุจุฑุฑุณ ฺฉูุฏ**:
   - ูุณูุช "localStorage" ุฑุง ุจุจูุฏ
   - ุขุง `coins: 0` ุงุณุชุ

3. **ุฑูุฑุด ููุฌูุฏ**:
   - ุฑู ุฏฺฉูู **"ุฑูุฑุด ููุฌูุฏ ุงุฒ ุณุฑูุฑ"** ฺฉูฺฉ ฺฉูุฏ
   - ููุชุธุฑ ุจูุงูุฏ ุชุง ูพุงู ููููุช ููุงุด ุฏุงุฏู ุดูุฏ

4. **ุจู wallet ุจุฑูุฏ**:
   - ุงุฒ ููฺฉ ููุฌูุฏ ุฏุฑ ูพุงู ููููุช ุงุณุชูุงุฏู ฺฉูุฏ
   - ุง ุจู `http://localhost:3000/profile/wallet` ุจุฑูุฏ
   - ุตูุญู ุฑุง ุฑูุฑุด ฺฉูุฏ (`F5`)

### ุฑูุด 2: ูพุงฺฉ ฺฉุฑุฏู localStorage (ุณุฑุนโุชุฑู)

1. **F12** ุฑุง ุจุฒูุฏ (Developer Tools)

2. **Console** ุฑุง ุจุงุฒ ฺฉูุฏ

3. ุงู ฺฉุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏ:
   ```javascript
   localStorage.clear();
   alert('localStorage ูพุงฺฉ ุดุฏ! ุงฺฉููู ุฏูุจุงุฑู ูุงฺฏู ฺฉูุฏ.');
   ```

4. **ุฏูุจุงุฑู ูุงฺฏู ฺฉูุฏ**:
   - ุจู ุตูุญู ูุงฺฏู ุจุฑูุฏ
   - ุจุง ุดูุงุฑู ุชููู ฺฉู ููุฌูุฏุด ุฑุง ุชุบุฑ ุฏุงุฏูโุงุฏ ูุงุฑุฏ ุดูุฏ

5. **ุจู wallet ุจุฑูุฏ**:
   - `/profile/wallet` ุฑุง ุจุงุฒ ฺฉูุฏ
   - ุจุงุฏ ููุฌูุฏ ุฌุฏุฏ ุฑุง ุจุจูุฏ โ

### ุฑูุด 3: ุฑูุฑุด ุฏุณุช ููุฌูุฏ (ุจุฑุง Developers)

1. **F12** โ **Console**

2. ุงู ฺฉุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏ:
   ```javascript
   (async () => {
     const token = localStorage.getItem('token');
     if (!token) {
       alert('Token ุงูุช ูุดุฏ! ูุทูุงู ูุงฺฏู ฺฉูุฏ.');
       return;
     }

     const response = await fetch('http://localhost:8001/api/users/coins', {
       headers: { 'Authorization': `Bearer ${token}` }
     });

     if (response.ok) {
       const data = await response.json();
       console.log('ููุฌูุฏ ุงุฒ ุณุฑูุฑ:', data.coins);

       // ุจูโุฑูุฒุฑุณุงู localStorage
       const userStr = localStorage.getItem('user');
       if (userStr) {
         const user = JSON.parse(userStr);
         user.coins = data.coins;
         localStorage.setItem('user', JSON.stringify(user));
         alert(`ููุฌูุฏ ุจูโุฑูุฒ ุดุฏ: ${data.coins.toLocaleString()} ุชููุงู`);
         window.location.reload();
       }
     } else {
       alert('ุฎุทุง ุฏุฑ ุฏุฑุงูุช ููุฌูุฏ');
     }
   })();
   ```

## ๐ ุนุจโุงุจ ฺฏุงู ุจู ฺฏุงู

### ูุฑุญูู 1: ุจุฑุฑุณ Backend

```bash
# ุงุฌุฑุง ุชุณุช API
python test_users_me_endpoint.py
```

ุจุงุฏ ุจุจูุฏ:
```
โ ููุฌูุฏ ุฏุฑ /users/me: 150,000 ุชููุงู
โ ููุฌูุฏ ุตุญุญ ุงุณุช!
```

### ูุฑุญูู 2: ุจุฑุฑุณ localStorage

1. **F12** โ **Application** (ุง **Storage**)
2. **Local Storage** โ `http://localhost:3000`
3. ฺฉูุฏ `user` ุฑุง ูพุฏุง ฺฉูุฏ
4. ููุฏุงุฑ ุฑุง ุจุงุฒ ฺฉูุฏ ู `coins` ุฑุง ุจุจูุฏ

**ุงฺฏุฑ `coins: 0` ุจูุฏ** โ ูุดฺฉู ููู ุงุณุช!

### ูุฑุญูู 3: ุจุฑุฑุณ Network

1. **F12** โ **Network**
2. ุจู `/profile/wallet` ุจุฑูุฏ
3. ููุชุฑ ฺฉูุฏ: `coins` ุง `/users/`
4. ุจุฑุฑุณ ฺฉูุฏ:
   - ุขุง ุฏุฑุฎูุงุณุช ุจู `/users/coins` ุง `/users/me` ุงุฑุณุงู ูโุดูุฏุ
   - Response ฺุณุชุ

## ๐ฑ ุชุณุช ููุง

### ุจุง ุดูุงุฑู ุชููู ูุดุฎุต:

1. **ุฏุฑ ูพูู ุงุฏูู** (http://localhost:3000/admin-full):
   - ุจุฎุด ฺฉุงุฑุจุฑุงู
   - ฺฉุงุฑุจุฑ ุจุง ุดูุงุฑู `09464634646` ุฑุง ูพุฏุง ฺฉูุฏ
   - ููุฌูุฏ: `150,000` ุชููุงู โ

2. **Logout ฺฉุงูู**:
   - ุงุฒ ุญุณุงุจ ูุนู ุฎุงุฑุฌ ุดูุฏ
   - F12 โ Console โ `localStorage.clear()`

3. **Login ุฏูุจุงุฑู**:
   - ุจุง ุดูุงุฑู `09464634646` ูุงุฑุฏ ุดูุฏ
   - ฺฉุฏ OTP ุฑุง ูุงุฑุฏ ฺฉูุฏ

4. **ุจู wallet ุจุฑูุฏ**:
   - `/profile/wallet`
   - ุจุงุฏ `150,000` ุชููุงู ุฑุง ุจุจูุฏ โ

## ๐๏ธ ุฑูุน ูุดฺฉู ุฏุงุฆู

ุจุฑุง ุงูฺฉู ุงู ูุดฺฉู ุฏฺฏุฑ ูพุด ูุงุฏุ ุจุงุฏ:

### 1. ุจุนุฏ ุงุฒ ุชุบุฑ ููุฌูุฏ ุฏุฑ ุงุฏููุ localStorage ุฑุง ุฑูุฑุด ฺฉูุฏ

ุฏุฑ ูุงู `frontend/src/app/admin-full/page.tsx` (ุฎุท 3312):

**ุงูุงู:**
```javascript
alert('ููุฌูุฏ ุจุง ููููุช ุชุบุฑ ฺฉุฑุฏ');
```

**ุจูุชุฑ:**
```javascript
alert('ููุฌูุฏ ุจุง ููููุช ุชุบุฑ ฺฉุฑุฏ\n\nุชูุฌู: ฺฉุงุฑุจุฑ ุจุงุฏ localStorage ุฑุง ูพุงฺฉ ฺฉูุฏ ุง ุฏูุจุงุฑู ูุงฺฏู ฺฉูุฏ');
```

### 2. ุฏุฑ AuthContextุ ุฒูุงูโุจูุฏ ููุงุณุจ ุจุฑุง refresh

ูุงู `frontend/src/contexts/AuthContext.tsx` ุฏุฑ ุญุงู ุญุงุถุฑ:
- โ ููฺฏุงู focus window
- โ ููฺฏุงู mount wallet page

ุงู ฺฉุงู ุงุณุชุ ูู ุงฺฏุฑ ูุดฺฉู ุฏุงุฑุฏ:

**ุงุถุงูู ฺฉุฑุฏู interval:**
```javascript
useEffect(() => {
  const interval = setInterval(() => {
    if (user?.id) refreshCoins();
  }, 30000); // ูุฑ 30 ุซุงูู

  return () => clearInterval(interval);
}, [user?.id, refreshCoins]);
```

## โ ฺฺฉ ูุณุช ููุง

- [ ] Backend ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช (port 8001)
- [ ] Frontend ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช (port 3000)
- [ ] `test_users_me_endpoint.py` ูููู ุงุณุช
- [ ] ุฏุฑ ูพูู ุงุฏูู ููุฌูุฏ ุชุบุฑ ฺฉุฑุฏู
- [ ] localStorage ุฑุง ูพุงฺฉ ฺฉุฑุฏูโุงู (`localStorage.clear()`)
- [ ] ุฏูุจุงุฑู ูุงฺฏู ฺฉุฑุฏูโุงู
- [ ] ุจู `/profile/wallet` ุฑูุชูโุงู
- [ ] ููุฌูุฏ ุฌุฏุฏ ุฑุง ูโุจูู โ

## ๐ ููุช ฺฉุงุฑ ฺฉุฑุฏ

ุงฺฏุฑ ููุฌูุฏ ุฏุฑุณุช ููุงุด ุฏุงุฏู ุดุฏ:
1. โ Backend ฺฉุงุฑ ูโฺฉูุฏ
2. โ Frontend ฺฉุงุฑ ูโฺฉูุฏ
3. โ localStorage ุชูุฒ ุงุณุช
4. โ ููู ฺุฒ OK ุงุณุช!

---

**ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู:** 2025-10-06  
**ูุถุนุช:** Backend ุชุณุช ุดุฏู โ | Frontend ูุงุฒ ุจู clear cache ุฏุงุฑุฏ

